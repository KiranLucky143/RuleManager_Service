<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Rules in Ruleset</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: #f9fafb; color: #222; }
        h2 { color: #0d6efd; }
        .table thead th { background-color: #f8f9fa; }
        .table tbody tr:hover { background-color: #f1f5ff; }
        .msg { margin-top:8px; padding:8px; border-radius:4px; display:none; }
        .msg.error { background:#fdecea; color:#611; display:block; }
        .muted { color:#6c757d; font-size:0.9rem; }
        .top-bar { display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; }
        .upload-box { background:white; border-radius:8px; padding:16px; box-shadow:0 2px 8px rgba(0,0,0,0.05); margin-top:16px; }
        .table-container { background:white; border-radius:8px; padding:16px; box-shadow:0 2px 8px rgba(0,0,0,0.05); margin-top:16px; }
        .btn-custom { border-radius:6px; }
    </style>
</head>
<body class="container py-4">
<div class="top-bar mb-4">
    <div>
        <h2 th:text="'Rules for: ' + ${ruleset.name}">Ruleset Name</h2>
        <div class="muted" th:text="${ruleset.description}">description</div>
    </div>
    <div>
        <a th:href="@{/rulesets-ui}" class="btn btn-outline-secondary btn-sm btn-custom">
            ‚Üê Back to Rulesets
        </a>
    </div>
</div>

<!-- Upload Section -->
<div class="upload-box">
    <form th:action="@{/rulesets/{id}/files-ui(id=${ruleset.id})}" method="post" enctype="multipart/form-data" class="row g-3 align-items-center">
        <div class="col-md-4">
            <label class="form-label fw-semibold">Choose file (.drl, .dmn, .xlsx)</label>
            <input type="file" name="file" class="form-control" required />
        </div>
        <div class="col-md-3">
            <label class="form-label fw-semibold">Order Index (optional)</label>
            <input type="text" name="orderIndex" class="form-control" value="0" placeholder="0" />
        </div>
        <div class="col-md-3 d-flex align-items-end">
            <button type="submit" class="btn btn-primary btn-custom">Upload</button>
        </div>
    </form>

    <div th:if="${error}" class="msg error mt-3" th:text="${error}"></div>
</div>

<!-- Rules Table -->
<div class="table-container">
    <table class="table table-hover align-middle">
        <thead>
        <tr>
            <th>ID</th>
            <th>File Name</th>
            <th>Type</th>
            <th>Active</th>
            <th style="width: 200px;">Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="r : ${rules}">
            <td th:text="${r.id}">1</td>
            <td th:text="${r.ruleName}">rule.drl</td>
            <td>
                <span th:text="${r.ruleType}" class="badge bg-info text-dark">DRL</span>
            </td>
            <td>
                <span th:if="${r.active}" class="badge bg-success">Active</span>
                <span th:unless="${r.active}" class="badge bg-secondary">Inactive</span>
            </td>
            <td class="text-nowrap">
                <a th:href="@{/rulesets/{rid}/files/{fileId}/download(rid=${ruleset.id},fileId=${r.id})}"
                   class="btn btn-sm btn-outline-primary me-1 btn-custom" target="_blank">Download</a>

                <a th:href="@{/rulesets/{rid}/files/{fileId}/edit(rid=${ruleset.id},fileId=${r.id})}"
                   class="btn btn-sm btn-outline-warning me-1 btn-custom">Edit</a>

                <form th:action="@{/rulesets/{rid}/files/{fileId}/delete(rid=${ruleset.id},fileId=${r.id})}"
                      method="post" class="d-inline"
                      onsubmit="return confirm('Delete this rule?');">
                    <button type="submit" class="btn btn-sm btn-outline-danger btn-custom">Delete</button>
                </form>
            </td>
        </tr>

        <tr th:if="${#lists.isEmpty(rules)}">
            <td colspan="5" class="text-center text-muted py-3">
                No rules uploaded yet for this ruleset.
            </td>
        </tr>
        </tbody>
    </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
