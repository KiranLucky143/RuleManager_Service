<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${rule.id} != null ? 'Edit Rule' : 'New Rule'">Rule Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <script>
        function toggleInputs() {
            let type = document.getElementById("ruleType").value;
            let drlContent = document.getElementById("drlContent");
            let fileUpload = document.getElementById("fileUpload");

            if (type === "DRL") {
                drlContent.style.display = "block";
                fileUpload.style.display = "none";
                document.querySelector("#drlContent textarea").required = true;
            } else {
                drlContent.style.display = "none";
                fileUpload.style.display = "block";
                document.querySelector("#drlContent textarea").value = "";
                document.querySelector("#drlContent textarea").required = false;
            }
        }
        document.addEventListener("DOMContentLoaded", toggleInputs);
    </script>
</head>
<body class="bg-light">

<div class="container mt-5">
    <div class="card shadow-lg border-0">
        <div class="card-header bg-gradient bg-info text-white">
            <h4 class="mb-0" th:text="${rule.id} != null ? 'âœï¸ Edit Rule' : 'âž• Create New Rule'"></h4>
        </div>
        <div class="card-body">
            <form th:action="@{/rules}" th:object="${rule}" method="post" enctype="multipart/form-data">
                <input type="hidden" th:field="*{id}"/>

                <!-- Rule Name -->
                <div class="mb-3">
                    <label class="form-label fw-bold">Rule Name</label>
                    <input type="text" class="form-control" th:field="*{ruleName}" placeholder="Enter rule name" required/>
                </div>

                <!-- Rule Type -->
                <div class="mb-3">
                    <label class="form-label fw-bold">Rule Type</label>
                    <select class="form-select" id="ruleType" th:field="*{ruleType}" onchange="toggleInputs()" required>
                        <option value="DRL">DRL (Text Rule)</option>
                        <option value="DECISION_TABLE">Decision Table (Excel/CSV)</option>
                        <option value="DMN">DMN (Decision Model)</option>
                    </select>
                </div>

                <!-- DRL Content -->
                <div class="mb-3" id="drlContent">
                    <label class="form-label fw-bold">Rule Content (DRL)</label>
                    <textarea class="form-control" th:field="*{ruleContent}" rows="8" placeholder="// Write Drools rule here..."></textarea>
                </div>

                <!-- File Upload -->
                <div class="mb-3" id="fileUpload" style="display:none;">
                    <label class="form-label fw-bold">Upload File (Decision Table / DMN)</label>
                    <input type="file" th:field="*{uploadedFile}" class="form-control" accept=".xls,.xlsx,.csv,.dmn,.xml">

                    <!-- Show existing file if available -->
                    <div th:if="${rule.ruleFile != null}" class="mt-2">
                        <span class="badge bg-secondary">ðŸ“Ž File already uploaded</span>
                        <a th:href="@{'/rules/download/' + ${rule.id}}" class="btn btn-sm btn-outline-info ms-2">â¬‡ Download</a>
                    </div>
                </div>

                <!-- Active Checkbox -->
                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" th:field="*{active}" id="activeCheckbox"/>
                    <label class="form-check-label" for="activeCheckbox">Active</label>
                </div>

                <!-- Buttons -->
                <div class="d-flex justify-content-between">
                    <a href="/rules" class="btn btn-secondary">â¬… Back</a>
                    <button type="submit" class="btn btn-success">ðŸ’¾ Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

</body>
</html>
